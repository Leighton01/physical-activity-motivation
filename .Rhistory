theme_clean()
gg.llik.ad
# # Max posterior
# gg.post.his.ad <- ggplot(adult.lik, aes(x = post, fill = factor(class))) +
#   geom_histogram(binwidth = 0.05, alpha = 0.7, position = "identity") +
#   labs(x = "Max Posterior Probability", y = "Count", fill = "Class",
#        title = paste0(k," Classes, Adults")) +
#   theme_clean()
# gg.post.his.ad
#
# # Boxplot
# gg.post.box.ad <- ggplot(adult.lik, aes(x = factor(class), y = post)) +
#   geom_boxplot(fill = "skyblue") +
#   labs(x = "Class", y = "Max Posterior Probability",
#        title = paste0(k," Classes, Adults")) +
#   theme_clean()
# class,size/proportion, average pp,entropy
tb.class3.ad <- data.frame(
Class = 1:ncol(post3.ad),
Proportion = as.numeric(class.size3.ad),
Avg_Posterior = round(ave.pp3.ad, 3)
)
tb.class3.ad
mins.adult <- data.frame(
Class = 1:n.classes,
Weighted.Median = wmed.ad,
Weighted.Q25 = wq25.ad,
Weighted.Q75 = wq75.ad
)
mins.adult
gg.mins.ad <- ggplot(mins.adult, aes(x = factor(Class), y = Weighted.Median)) +
geom_point(size = 3, color = "blue") +                 # median as a point
geom_errorbar(aes(ymin = Weighted.Q25, ymax = Weighted.Q75),
width = 0.2, color = "darkblue") +      # IQR as error bars
labs(x = "Class", y = "Minutes (Weighted Median Â± IQR)",
title = "Weighted Median and IQR per Class") +
theme_clean()
gg.mins.ad
#
# # Weighted minutes, youths
# gg.med.ad <- ggplot(mins.adult, aes(x = Class, y = Weighted.Median)) +
#   geom_col() +
#   labs(x = "Latent Class", y = "Probability-Weighted Median Minutes")
# Predictor plot
plot(LCAE.ad, nclass = 2)
# plot(LCAE.ad, nclass = 3)
# Bootstrap Vuong-Lo-Mendell-Rubin Likelihood Ratio Test
# 100 reps
# blrt.ad
or.ad
or.ci.ad
# Include actual coeffs in appendix
lca.best.ad$probs
tb.byage.ad
gg.byage.ad <- adult.lik %>%
dplyr::count(age, class) %>%
group_by(age) %>%
mutate(prop = n / sum(n)) %>%
ggplot(aes(x = factor(age), y = prop, fill = factor(class))) +
geom_col() +
labs(x = "Age group", y = "Proportion", fill = "Class") +
scale_y_continuous(labels = scales::percent_format()) +
theme_clean()
gg.byage.ad
vars.ad <- setdiff(names(adult.lik), c("age","mins","post","class",
"gender","eth","edu"))
adult.lik_long <- adult.lik %>%
pivot_longer(cols = all_of(vars.ad), names_to = "variable", values_to = "score") %>%
count(age, variable, score) %>%
group_by(age, variable) %>%
mutate(prop = n / sum(n))
gg.vars.ad <- ggplot(adult.lik_long, aes(x = factor(age), y = prop, fill = factor(score))) +
geom_col() +
facet_wrap(~variable, nrow = 3, ncol = 3) +
labs(x = "Age group", y = "Proportion", fill = "Score") +
scale_y_continuous(labels = percent_format()) +
theme_clean() +
theme(legend.position = "bottom", axis.text.y = element_text(size = 6))
gg.vars.ad
wmed.ad
tb.class3.ad
gg.mins.ch
gg.elbow.ad
gg.llik.ad
tb.class4.ad
tb.class4.ad <- data.frame(
Class = 1:ncol(post4.ad),
Proportion = as.numeric(class.size4.ad),
Avg_Posterior = round(ave.pp4.ad, 4)
)
tb.class4.ad
tb.class5.ad <- data.frame(
Class = 1:ncol(post5.ad),
Proportion = as.numeric(class.size5.ad),
Avg_Posterior = round(ave.pp5.ad, 5)
)
tb.class5.ad
tb.class6.ad <- data.frame(
Class = 1:ncol(post6.ad),
Proportion = as.numeric(class.size6.ad),
Avg_Posterior = round(ave.pp6.ad, 6)
)
tb.class6.ad
post6.ad <- LCAE.ad$LCA[[5]]$posterior
class6.ad <- apply(post6.ad, 1, which.max)
class.size6.ad <- prop.table(table(class6.ad))
ave.pp6.ad <- sapply(1:ncol(post6.ad), function(k) {
inds <- which(class6.ad == k)
mean(post6.ad[inds, k])
})
ave.pp6.ad
tb.class6.ad <- data.frame(
Class = 1:ncol(post6.ad),
Proportion = as.numeric(class.size6.ad),
Avg_Posterior = round(ave.pp6.ad, 6)
)
tb.class6.ad
LCAE.ad
LCAE.ad$output
ad.lca.output
plot(LCAE.ad, nclass = 2)
plot(LCAE.ad, nclass = 3)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 2)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 3)
plot(LCAE.ad, nclass = 2)
gg.byage.ad
summary(LCAE.ad, nclass = 2)
LCAE.ad$LCA
LCAE.ad$LCA[[2]]
gg.mins.ad
tb.mins.ad
mins.adult
plot(LCAE.ch, nclass=2)
plot(LCAE.ch, nclass=3)
LCAE.ch$LCA[[2]]
plot(LCAE.ad, nclass=2)
plot(LCAE.ad, nclass=3)
LCAE.ad$LCA[[3]]
gg.byage.ad
tb.byage.ad
gg.mins.ad
mins.ad
mins.adult
plot(LCAE.ad, nclass=2)
gg.byage.ad
gg.byage.ch
gg.byage.ch
gg.mins.ch
gg.mins.ch
gg.mins.ad
mins.adult
mins.child
gg.vars.ad
or.ci.ad
or.ad
or.ch
or.ci.ch
rmdwc::rmdcount('Paper.rmd')
slopes.diff
or.ad
plot(LCAE.ad, nclass = 2)
LCAE.ad
plot(LCAE.ad, nclass = 2)
LCAE.ad$LCA[[2]]
LCAE.ad$output
LCAE.ad$LCA[[2]]
LCAE.ad$LCA[2]
LCAE.ad$LCA[[2]]
LCAE.ad$LCA[[3]]
LCAE.ad$output
LCAE.ad$summary
LCAE.ad$LCA[[2]][[2]]
LCAE.ad$LCA[[2]][[1]]
LCAE.ad$LCA[[2]]$probs
gg.byage.ad
gg.byage.ch
or.ad
or.ci.ch
or.ch
or.ad
slopes.diff
rmdwc::rmdcount('Paper.rmd')
rmdwc::rmdcount('Paper.rmd')
rmdwc::rmdcount('Paper.rmd')
adult.summary
nrows(adult.lik)
nrow(adult.var)
nrow(adult.bi)
nrow(adult.lik)
child.summary
summary(child.bi)
summary(child.bi)[1]
summary(child.bi)[3]
summary(child.bi)[3,]
summary(child.bi)[4,]
pivot_long(summary(child.bi)[3,])
library(tidyverse)
pivot_long(summary(child.bi)[3,])
pivot_longer(summary(child.bi)[3,])
pivot_long(summary(child.bi)[3,])
summary(child.bi)[3,]
class(summary(child.bi)[4,])
as.dataframe(summary(child.bi)[4,])
dataframe(summary(child.bi)[4,])
data.frame(summary(child.bi)[4,])
data.frame(summary(child.bi)[4,])[1]
data.frame(summary(child.bi)[4,])[,1]
data.frame(summary(child.bi)[4,])
data.frame(summary(child.bi)[4,])[,2]
data.frame(summary(child.bi)[4,])[,1]
data.frame(summary(child.bi)[4,])
colMeans(child.bi, na.rm = TRUE)
data.frame(colMeans(child.bi, na.rm = TRUE))
colnames(child.summary.bi) <- ("Mean")
child.summary.bi <- data.frame(colMeans(child.bi, na.rm = TRUE))
colnames(child.summary.bi) <- ("Mean")
child.summary.bi
child.summary.bi <- child.summary.bi %>% filter(-age,-eth,-gender)
child.summary.bi <- child.summary.bi %>% dyplyer::filter(-age,-eth,-gender)
child.summary.bi <- child.summary.bi %>% dplyer::filter(-age,-eth,-gender)
child.summary.bi <- child.summary.bi %>% dplyr::filter(-age,-eth,-gender)
numeric_cols <- setdiff(names(child.bi), c("gender", "eth", "age"))
# Compute means
colMeans(child.bi[, numeric_cols], na.rm = TRUE)
library(ggthemes)
library(ggthemes)
child.summary.bi
library(ggthemes)
library(ggthemes)
child.summary.bi <- data.frame(colMeans(
child.bi[, setdiff(names(child.bi),
c("gender", "eth", "age"))], na.rm = TRUE))
child.summary.bi
colnames(child.summary.bi) <- ("Mean")
child.summary.bi
child.summary.bi <- data.frame(colMeans(
child.bi[, setdiff(names(child.bi),
c("gender", "eth", "age"))], na.rm = TRUE))
colnames(child.summary.bi) <- ("Mean")
adult.summary.bi <- data.frame(colMeans(
adult.bi[, setdiff(names(adult.bi),
c("gender", "eth", "age"))], na.rm = TRUE))
colnames(adult.summary.bi) <- ("Mean")
adult.summary.bi
adult.summary.bi
child.summary.bi
unique(child.bi$relxb)
summary(adult.bi)
child.bi <- child.var %>%
filter(Disab_All_POP == 2, # remove disabled and no answer
gend3 %in% c(1,2),
eth2 %in% c(1,2),
if_all(c(age_11, mins_modplus_outschool_Week_ALL), ~ .x > -1),
if_all(c(PL_Enjoy_bc_SA_gr2, MO_Fun_c_SA, MO_Fit_c_SA,
MO_Guilt_c_SA, MO_Opp_c_SA, MO_Relax_c_SA), ~ .x > -1 & .x < 3)) %>%
dplyr::select(enjoyb=PL_Enjoy_bc_SA_gr2,
socialb=MO_Fun_c_SA,
fitb=MO_Fit_c_SA,
guiltb=MO_Guilt_c_SA,
oppb=MO_Opp_c_SA,
relxb=MO_Relax_c_SA,
gender=gend3,
age=age_11,
eth=eth2,
mins=mins_modplus_outschool_Week_ALL
) %>%
# change 2 (not strongly agree) to 0, consistent with adult
mutate(across(c(enjoyb,socialb,fitb,guiltb,oppb,relxb), ~ ifelse(.x==2, 0, .x)),
gender = gender-1,
eth = eth-1,
age = age-11)
adult.bi <- adult.var %>% filter(Disab2_POP==2,
Gend3 %in% c(1,2),
Eth2 %in% c(1,2),
if_all(c(AgeTGC,
DUR_MOD_CAPPED_SPORTCOUNT_A01,
DUR_HVY_CAPPED_SPORTCOUNT_A01),
~ .x > -1),
if_all(c(Motiva_POP_GR2, motivex2c_GR2,
motivex2a_GR2, motivc_POP_GR2,
READYOP1_POP_GR2, motivex2b_GR2),
~ .x %in% c(0,1))) %>%
mutate(mins=DUR_MOD_CAPPED_SPORTCOUNT_A01 +
DUR_HVY_CAPPED_SPORTCOUNT_A01,
Gend3 = Gend3-1,
Eth2 = Eth2-1,
age = case_when(Age9==2~3L,
Age9==9~8L,
TRUE~as.integer(Age9)),
age=as.integer(age-3)
) %>%
dplyr::select(enjoyb=Motiva_POP_GR2,
socialb=motivex2c_GR2,
fitb=motivex2a_GR2,
guiltb=motivc_POP_GR2,
oppb=READYOP1_POP_GR2,
relxb=motivex2b_GR2,
gender=Gend3,
age,
eth=Eth2,
mins
)
dallb <- bind_rows(
adult.bi %>% mutate(group = "adult"),
child.bi %>% mutate(group = "youth")
) %>%
mutate(mins = ifelse(mins > 1680, 1680, mins))
dallb$gender <- relevel(factor(dallb$gender), ref = "0")
dallb$eth <- relevel(factor(dallb$eth), ref = "0")
f0 <- sem(m0, data = dallb, group = "group")
sem.free <- summary(f0, fit.measures = TRUE, standardized = TRUE)
# Libraries ---------------------------------------------------------------
set.seed(2025)
library(tidyverse)
library(lavaan)
f0 <- sem(m0, data = dallb, group = "group")
sem.free <- summary(f0, fit.measures = TRUE, standardized = TRUE)
# Constrain all to be equal
f.con <- sem(m0, dallb, group = "group",
group.equal = c("intercepts", "regressions"))
# Check if significantly different
f0fcon <- anova(f0, f.con)
f0fcon
# Put slope diff. in a table
params <- parameterEstimates(f0, standardized = T)
# filter
slopes <- params %>%
filter(lhs == "mins", op == "~") %>%
dplyr::select(var=rhs, group, est, se)
# filtre more
slopes.ad <- slopes %>% filter(group == 1) %>%
dplyr::select(var, est.adult = est, se.adult = se)
slopes.ch <- slopes %>% filter(group == 2) %>%
dplyr::select(var, est.youth = est, se.youth = se)
# join!
slopes.diff <- data.frame()
slopes.diff <- left_join(slopes.ch, slopes.ad, by = "var")
# calculate
slopes.diff <- slopes.diff %>%
mutate(
diff = est.youth - est.adult
) %>%
filter(!var %in% c("gender","eth","age")) %>%
dplyr::select(-se.youth, -se.adult)
slopes.diff
rmdwc::rmdcount('Paper.rmd')
rmdwc::rmdcount('Paper.rmd')
nrow(adult.bi)
formatC(nrow(adult.bi), format="d", big.mark=",")
formatC(nrow(adult.bi), big.mark=",")
format(nrow(adult.bi), big.mark=",")
as.numeric(format(nrow(adult.bi), big.mark=","))
as.integer(format(nrow(adult.bi), big.mark=","))
prettyNum
prettyNum(nrow(adult.bi))
scales::comma_format(nrow(adult.bi))
library(scale)
library(scales)
scales::comma_format(nrow(adult.bi))
comma_format(digits = 12)
comma_format(digits = 12)(nrow(adult.bi))
comma(nrow(adult.bi))
prettyNum(child.bi, big.mark = ",")
prettyNum(nrow(adult.bi))
colnames(adult.lik)
colnames(adult.bi)
child.summary.bi
adult.summary
# Descriptive -------------------------------------------------------------
child.summary.bi <- data.frame(colMeans(
child.bi[, setdiff(names(child.bi),
c("gender", "eth", "age", "mins"))], na.rm = TRUE))
colnames(child.summary.bi) <- ("Mean")
# Descriptive -------------------------------------------------------------
child.summary.bi <- data.frame(colMeans(
child.bi[, setdiff(names(child.bi),
c("gender", "eth", "age", "mins"))], na.rm = TRUE))
colnames(child.summary.bi) <- ("Proportion")
child.summary.bi
adult.summary
prop.table(table(adult.bi$eth))
prop.table(table(adult.lik$eth))
prop.table(table(adult.lik$eth))[1,1]
prop.table(table(adult.lik$eth))[1]
prop.table(table(adult.lik$gender))
prop.table(table(adult.bi$gender))
`r prettyNum(prop.table(table(adult.lik$gender))[1], big.mark=",")`
prettyNum(prop.table(table(adult.lik$gender))[1], big.mark=",")
prettyNum(prop.table(table(adult.bi$gender))[1], big.mark=",")
gg.ad.gend
prop.table(table(adult.bi$gender))
class(prop.table(table(adult.bi$gender)))
class(prop.table(table(adult.bi$gender)))[1]
prop.table(table(adult.bi$gender))[1]
prop.table(table(adult.bi$gender))[[1]
]
prettyNum(prop.table(table(adult.bi$gender))[[2]], big.mark=",", digits = 2)
prettyNum(prop.table(table(adult.bi$gender))[[2]], big.mark=",", digits = 2)*100
prettyNum(prop.table(table(adult.bi$gender))[[2]]*100, big.mark=",", digits = 2)*100
prop.table(table(adult.bi$gender))[[2]]
prop.table(table(adult.bi$gender))[[2]]*100
prettyNum(prop.table(table(adult.bi$gender))[[2]]*100, big.mark=",", digits = 2)*100
prettyNum(prop.table(table(adult.bi$gender))[[2]]*100, big.mark=",", digits = 2)
gg.vars.ad
adult.summary
child.summary.bi
prettyNum(prop.table(table(child.bi$gender))[[2]]*100, big.mark=",", digits = 2)
prettyNum(prop.table(table(child.lik$gender))[[2]]*100, big.mark=",", digits = 2)
prop.table(table(child.lik$gender))
prop.table(table(child.bi$gender))
prop.table(table(child.bi$eth))
prop.table(table(child.lik$eth))
slopes.diff
gg.elbow.ad
gg.llik.ad
plot(LCAE.ad, nclass = 2)
plot(LCAE.ad, nclass = 2)
LCAE.ad
plot(LCAE.ad, nclass = 2)
plot(LCAE.ad, nclass = 3)
gg.byage.ad
mins.ch
gg.mins.ch
or.ad
rmdwc::rmdcount('Paper.rmd')
vc3 <- c("I enjoy taking part in exercise and sports.",
"I exercise socially for fun with friends.",  "I exercise to stay fit and healthy.",
"I feel that I have the opportunity to be physically active.",
"I feel guilty when I don't exercise.",
"I understand why exercise and sports are good for me.",
"If I find something difficult, I keep trying until I can do it.",
"I feel confident when I exercise and play sports.",
"I exercise to help me relax and worry less about things ."
)
vc <- data.frame(vc1,vc2,vc3)
vc1 <- c('enjoy','social','fit','opp','guilt','imp','chal','abil','relx')
vc2 <- c('PL_Enjoy_bc_ans','MO_Fun_c','MO_Fit_c','MO_Opp_c','MO_Guilt_c',
'PL_GdMe_bc_ans','Try_bc','PL_Conf_bc_ans','MO_Relax_c')
vc3 <- c("I enjoy taking part in exercise and sports.",
"I exercise socially for fun with friends.",
"I exercise to stay fit and healthy.",
"I feel that I have the opportunity to be physically active.",
"I feel guilty when I don't exercise.",
"I understand why exercise and sports are good for me.",
"If I find something difficult, I keep trying until I can do it.",
"I feel confident when I exercise and play sports.",
"I exercise to help me relax and worry less about things ."
)
vc <- data.frame(vc1,vc2,vc3)
vc
colnames(vc) <- c("Variable", "Origianl Variable Name", "Survey Question")
vc
va1 <- c('enjoy','social','fit','opp','guilt','imp','chal','abil','relx')
va2 <- c('Motiva_POP','motivex2c','motivex2a','READYOP1_POP','motivc_POP',
'motivb_POP','motivex2d','READYAB1_POP','motivex2b')
va3 <- c("Motivation for sport/exercise: I find sport/exercise enjoyable and satisfying.",
"I exercise socially for fun with friends.",
"I exercise to stay fit and healthy.",
"Readiness for activity: Opportunity,",
"Motivation for sport/exercise: I feel guilty when I don't do sport/exercise.",
"Motivation for sport/exercise: It's important to me to do sport/exercise regularly.",
"I exercise to challenge myself (either against myself or others).",
"Readiness for activity: Ability.",
"I exercise to help me relax and worry less about things."
)
va <- data.frame(va1,va2,va3)
colnames(va) <- c("Variable", "Origianl Variable Name", "Survey Question")
va
resid(f0, type = "raw")
library(tidyverse)
library(lavaan)
# Libraries ---------------------------------------------------------------
set.seed(2025)
resid(f0, type = "raw")
resid(f0, type = "standardized")
std_resid <- resid(f0, type = "standardized")$cov
std_resid_vec <- as.vector(std_resid)
qqnorm(std_resid_vec)
qqline(std_resid_vec, col = "red")
qqnorm(std_resid_vec)
std_resid_vec
std_resid_vec <- as.vector(std_resid)
std_resid_vec
std_resid_
std_resid
resid(f0, type = "standardized")$cov
resid(f0, type = "standardized")
resid(f0, type = "cor")
# Check adult lik corr
cor(child.lik.back0 %>% dplyr::select(-gender,-eth, -age), method = "pearson")
cor(adult.lik.back0 %>% dplyr::select(-gender,-eth,-age), method = "pearson")
# check residual
resid(f0, type = "corr")
# check residual
resid(f0, type = "cor")
vif(vif_model)
library(car)
vif(vif_model)
slopes.diff
LCAE.ch$output[2,6]
LCAE.ch$output[3,6]
gg.elbow.ch
gg.elbow.ad
r LCAE.ad$output[2,6]
r LCAE.ad$output[3,6]
LCAE.ad$output[3,6]
LCAE.ad$output[2,6]
rmdwc::rmdcount('Paper.rmd')
