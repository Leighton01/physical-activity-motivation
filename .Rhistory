# Main outcome
mins ~ enjoyb + guiltb + oppb + fitb + c(a,a)*socialb + age + gender + eth
'
# Small eigenvalue close to 0, does not matter
f1 <- sem(m1, data = dallb, group = "group", meanstructure = TRUE)
f2 <- sem(m2, data = dallb, group = "group", meanstructure = TRUE)
f3 <- sem(m3, data = dallb, group = "group", meanstructure = TRUE)
f4 <- sem(m4, data = dallb, group = "group", meanstructure = TRUE)
f5 <- sem(m5, data = dallb, group = "group", meanstructure = TRUE)
# Check all models are significantly different from m0
anova(f0, f1)
anova(f0, f2)
anova(f0, f3)
anova(f0, f4)
anova(f0, f5)
anova(f0,f1,f2)
anova(f0,f1,f2,f3)
cohen_d_lavaan <- function(model, param_name) {
slopes <- parameterEstimates(model, standardized = FALSE)
# filter for the path from enjoyb to mins
slopes_path <- slopes[slopes$lhs == "mins" & slopes$rhs == param_name, ]
# slopes_path$est will contain the slope for each group in the same order as your data
# group 1 = adult, 2 youth
slope_youth <- slopes_path$est[slopes_path$group == 2]
slope_adult <- slopes_path$est[slopes_path$group == 1]
# 2. Get pooled SD of your outcome variable (mins)
mins_youth <- dallb$mins[dallb$group=="youth"]
mins_adult <- dallb$mins[dallb$group=="adult"]
pooled_sd <- sqrt(((length(mins_youth)-1)*var(mins_youth) +
(length(mins_adult)-1)*var(mins_adult)) /
(length(mins_youth) + length(mins_adult) - 2))
# 3. Cohen's d-like effect of slope difference
cohen_d <- (slope_youth - slope_adult) / pooled_sd
return(c(cohen_d, cohen_d*pooled_sd))
}
cohen_d_lavaan(f0, "enjoyb")
cohen_d_lavaan(f0, "socialb")
cohen_d_lavaan(f0, "fitb")
cohen_d_lavaan(f0, "guiltb")
cohen_d_lavaan(f0, "oppb")
# Libraries ---------------------------------------------------------------
set.seed(2025)
library(tidyverse)
library(ggplot2)
library(nnet)
library(tidyLPA)
library(poLCA)
library(poLCAExtra)
colnames(child.lik)
# Predictors (motives)
child.lik.y <- as.matrix(child.lik %>% dplyr::select(-mins,-age,-gender,-eth))
child.lik.y[] <- lapply(child.lik.y, function(x) as.numeric((x)))
child.lik.y
# Predictors (motives)
child.lik.y <- as.matrix(child.lik %>% dplyr::select(-mins,-age,-gender,-eth))
child.lik.y
# Spec formula for LCA
lca.f.child <- child.lik.y ~ gender + eth
LCAE.ch <- poLCA(lca.f.child, data = child.lik, nclass = 1:7)
save(LCAE.ch, file="LCAE.ch.RData")
LCAE.ch$output
LCAE.ch$LCA
LCAE.ch$LCA[1]
str(LCAE.ch[1])
LCAE.ch$LCA[3]$llike
LCAE.ch$LCA[3]["llike"]
LCAE.ch$LCA[3$"llike"]
LCAE.ch$LCA[3][3]
LCAE.ch$LCA[3][[3]]
LCAE.ch$output[3]
LCAE.ch$output[6]
ch.lik <- LCAE.ch$output[3]
ch.ent <- LCAE.ch$output[6]
LCAE.ch$output[7]
LCAE.ch$output[8]
LCAE.ch$output
# ch.lik <- LCAE.ch$output[3]
# ch.AIC <- LCAE.ch$output[4]
# ch.BIC <- LCAE.ch$output[5]
# ch.ent <- LCAE.ch$output[6]
# ch.LMR <- LCAE.ch$output[7]
ch.lca.output <- LCAE.ch$output
# ch.lik <- LCAE.ch$output[3]
# ch.AIC <- LCAE.ch$output[4]
# ch.BIC <- LCAE.ch$output[5]
# ch.ent <- LCAE.ch$output[6]
# ch.LMR <- LCAE.ch$output[7]
ch.lca.output <- LCAE.ch$output %>% dplyr::select(nclass,llike,AIC,BIC,
Rel.Entropy,LMR)
# ch.lik <- LCAE.ch$output[3]
# ch.AIC <- LCAE.ch$output[4]
# ch.BIC <- LCAE.ch$output[5]
# ch.ent <- LCAE.ch$output[6]
# ch.LMR <- LCAE.ch$output[7]
ch.lca.output <- LCAE.ch$output %>% dplyr::select(nclass,llike,AIC,BIC,
Rel.Entropy,LMR)
# elbow plot
elbow.ch <- ggplot(ch.lca.output, aes(x = classes)) +
geom_line(aes(y = BIC), color = "blue") +
geom_point(aes(y = BIC), color = "blue") +
geom_line(aes(y = AIC), color = "red") +
geom_point(aes(y = AIC), color = "red") +
labs(y = "Information Criterion", x = "Number of Classes",
title = "Elbow Plot for poLCA Model Selection",
caption = "Blue = BIC, Red = AIC") +
theme_minimal()
elbow.ch
# elbow plot
elbow.ch <- ggplot(ch.lca.output, aes(x = nclass)) +
geom_line(aes(y = BIC), color = "blue") +
geom_point(aes(y = BIC), color = "blue") +
geom_line(aes(y = AIC), color = "red") +
geom_point(aes(y = AIC), color = "red") +
labs(y = "Information Criterion", x = "Number of Classes",
title = "Elbow Plot for poLCA Model Selection",
caption = "Blue = BIC, Red = AIC") +
theme_minimal()
nclass
elbow.ch
LCAE.ch$output
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 3)
poLCA.cov(LCAE.ch, nclass = 3)
LCAE.ch$LCA[3]
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 5)
poLCA.cov(LCAE.ch, nclass = 5)
LCAE.ch$output
LCAE.ch[3]
str(LCAE.ch)
LCAE.ch$LCA[2]$Posterior
LCAE.ch$LCA[2]$posterior
LCAE.ch$LCA[2]posterior
LCAE.ch$LCA[2][posterior]
LCAE.ch$LCA[2]["posterior"]
LCAE.ch$LCA$["posterior"]
LCAE.ch$LCA$posterior
LCAE.ch$LCA[3]
LCAE.ch$LCA[3]$enjoy
LCAE.ch$data[3]
glimpse(
)
glimpse(LCAE.ch$data)
glimpse(LCAE.ch$LCA)
glimpse(LCAE.ch$LCA[["posterior"]])
LCAE.ch[[3]]$posterior
names(LCAE.ch[[3]])
names(LCAE.ch$LCA[[3]])
LCAE.ch$LCA[[3]]$posterior
LCAE.ch$LCA[[3]]$predclass
# check posterior and boxplots
for(k in 3:5){
child.lik$post <- apply(LCAE.ch$LCA[[k]]$posterior, 1, max)
child.lik$class <- LCAE.ch$LCA[[k]]$predclass
print(
ggplot(child.lik, aes(x = post, fill = factor(class))) +
geom_histogram(binwidth = 0.05, alpha = 0.7, position = "identity") +
labs(x = "Max Posterior Probability", y = "Count", fill = "Class",
title = paste0(k," Classes, Youths")) +
theme_minimal()
)
print(ggplot(child.lik, aes(x = factor(class), y = post)) +
geom_boxplot(fill = "skyblue") +
labs(x = "Class", y = "Max Posterior Probability",
title = paste0(k," Classes, Youths")) +
theme_minimal()
)
}
LCAE.ch$LCA[[5]]$predclass
# check posterior and boxplots
for(k in 3:4){
child.lik$post <- apply(LCAE.ch$LCA[[k]]$posterior, 1, max)
child.lik$class <- LCAE.ch$LCA[[k]]$predclass
print(
ggplot(child.lik, aes(x = post, fill = factor(class))) +
geom_histogram(binwidth = 0.05, alpha = 0.7, position = "identity") +
labs(x = "Max Posterior Probability", y = "Count", fill = "Class",
title = paste0(k," Classes, Youths")) +
theme_minimal()
)
print(ggplot(child.lik, aes(x = factor(class), y = post)) +
geom_boxplot(fill = "skyblue") +
labs(x = "Class", y = "Max Posterior Probability",
title = paste0(k," Classes, Youths")) +
theme_minimal()
)
}
# check class size of candidates (need >0.5 per)
child.lik$class <- poLCA.child[[3]]$predclass
prop.table(table(child.lik$class))
# check class size of candidates (need >0.5 per)
child.lik$class <- LCAE.ch$LCA[[3]]$predclass
prop.table(table(child.lik$class))
child.lik$class <- LCAE.ch$LCA[[4]]$predclass
prop.table(table(child.lik$class))
ch.lca.output
# Best Model, Youths -------------------------------------------------------
lca.best.ch <- LCAE.ch$LCA[[3]]
child.lik$class <- lca.best.ch$predclass
child.lik$post <- lca.best.ch$posterior
post.ch <- child.lik$post
# Weighted means
child.lik$mins.log <- log(child.lik$mins+1)
# probability weighted means
wmeans.child <- colSums(post.ch * child.lik$mins) / colSums(post.ch)
wmeans.log.child <- colSums(post.ch * child.lik$mins.log) / colSums(post.ch)
# weighted SD
wsd.child <- sapply(1:ncol(post.ch), function(k) {
sqrt( sum(post.ch[,k] * (child.lik$mins - wmeans.child[k])^2)
/ sum(post.ch[,k]) )
})
# weighted log sd
wsd.log.child <- sapply(1:ncol(post.ch), function(k) {
sqrt( sum(post.ch[,k] * (child.lik$mins.log - wmeans.log.child[k])^2)
/ sum(post.ch[,k]) )
})
# Put everythign together
mins.child <- data.frame(
Class = factor(1:ncol(post.ch)),
Mean = wmeans.child,
Mean.log= exp(wmeans.log.child),
SD =wsd.child,
SD.log = wsd.log.child,
SD.low = exp(wmeans.log.child - wsd.log.child) - 1,
SD.up = exp(wmeans.log.child + wsd.log.child) - 1
)
mins.child
ch.lca.output
# Take relevant stats
ch.lca.output <- LCAE.ch$output %>% dplyr::select(nclass,llike,AIC,BIC,
Rel.Entropy,LMR,p)
ch.lca.output
LCAE.ch$output
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 3)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 4)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 5)
source("~/GitHub/Dissertation/LCA.R", echo = TRUE)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 3)
poLCA.cov(LCAE.ch, nclass = 3)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 6)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 7)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 4)
poLCA.cov(LCAE.ch, nclass = 4)
poLCA.cov(LCAE.ch, nclass = 2)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 2)
library(BayesLCA)
blca(child.lik.y, G=3)
blca(dallb, G=3)
blca(dallb %>% dplyr::select(-mins,-eth,-gender,-age,-group), G=3)
blca(dallb %>% dplyr::select(-mins,-eth,-gender,-age,-group), G=5)
blca(dallb %>% dplyr::select(-mins,-eth,-gender,-age,-group), G=4)
# elbow.ch
poLCA.residual.pattern(LCAE.ch, nclass = 2)
poLCA.cov(LCAE.ch, nclass = 2)
# Predictors (motives)
child.lik.y <- as.matrix(child.lik %>% dplyr::select(-mins,-age,-gender,-eth))
# Spec formula for LCA
lca.f.child <- child.lik.y ~ gender + eth
LCAE.ch <- poLCA(lca.f.child, data = child.lik, nclass = 1:7)
# Libraries ---------------------------------------------------------------
set.seed(2025)
library(tidyverse)
library(ggplot2)
library(nnet)
library(tidyLPA)
library(poLCA)
library(poLCAExtra)
LCAE.ch <- poLCAExtra::poLCA(lca.f.child, data = child.lik, nclass = 1:7)
LCAE.ch <- poLCA::poLCA(lca.f.child, data = child.lik, nclass = 1:7)
# Predictors (motives)
child.lik.y <- as.matrix(child.lik %>% dplyr::select(-mins,-age,-gender,-eth))
# Spec formula for LCA
lca.f.child <- child.lik.y ~ gender + eth
LCAE.ch <- poLCA::poLCA(lca.f.child, data = child.lik, nclass = 1:7)
load(file="LCAE.ch.RData")
# Take relevant stats
ch.lca.output <- LCAE.ch$output %>% dplyr::select(nclass,llike,AIC,BIC,
Rel.Entropy,LMR,p)
ch.lca.output
# bootstrapped Vuong-Lo-Mendell-Rubin likelihood ratio test
blrt.ch <- poLCA.blrt(LCAE.ch)
child.lik1 <- child.lik %>% dplyr::select(-gender,-eth,-group)
child.lik1 <- child.lik %>% dplyr::select(-gender,-eth)
cor(child.lik1, method = "pearson")
child.lik <- child.lik.back
child.lik1 <- child.lik %>% dplyr::select(-gender,-eth)
cor(child.lik1, method = "pearson")
adult.lik <- adult.lik.back
adult.lik1 <- adult.lik %>% dplyr::select(-gender,-eth)
cor(adult.lik1, method = "pearson")
adult.lik <- adult.lik.back
adult.lik1 <- adult.lik %>% dplyr::select(-gender,-eth,-imp)
cor(adult.lik1, method = "pearson")
adult.lik <- adult.lik.back
adult.lik1 <- adult.lik %>% dplyr::select(-gender,-eth)
cor(adult.lik1, method = "pearson")
adult.lik <- adult.lik.back
adult.lik1 <- adult.lik %>% dplyr::select(-gender,-eth, -imp, -abil)
cor(adult.lik1, method = "pearson")
colnames(dallb)
cor(dallb1, method = "pearson") # opp, fit and enjoy have mod corr with each other, others ok
nrow(child.var[child.var$PL_Conf_bc_ans>0])
nrow(child.var[child.var$PL_Conf_bc_ans>0,])
nrow(child.var[child.var$PL_Easy_bc_ans>0,])
child.lik <- child.lik.back
child.lik1 <- child.lik %>% dplyr::select(-gender,-eth,-easy)
cor(child.lik1, method = "pearson")
# remove -imp, -abil, corrleation too high with enjoy and opp, which makes sense
adult.lik <- adult.lik.back %>% dplyr::select(-imp, -abil)
# remove easy, corrleation too high with confidence, which makes sense
child.lik <- child.lik.back %>% dplyr::select(-easy)
child.lik.back <- child.lik
adult.lik.back <- adult.lik
# Predictors (motives)
child.lik.y <- as.matrix(child.lik %>% dplyr::select(-mins,-age,-gender,-eth))
# Spec formula for LCA
lca.f.child <- child.lik.y ~ gender + eth
LCAE.ch <- poLCA::poLCA(lca.f.child, data = child.lik, nclass = 1:7)
LCAE.ch <- poLCA::poLCA(lca.f.child, data = child.lik, nclass = 2:7)
child.lik
# Spec formula for LCA
lca.f.child <- child.lik.y ~ gender + eth
LCAE.ch <- poLCA::poLCA(lca.f.child, data = child.lik, nclass = 2:7)
LCAE.ch <- poLCAExtra::poLCA(lca.f.child, data = child.lik, nclass = 2:7)
save(LCAE.ch, file="LCAE.ch.RData")
# bootstrapped Vuong-Lo-Mendell-Rubin likelihood ratio test
blrt.ch <- poLCA.blrt(LCAE.ch)
adult.lik <- adult.lik.back
adult.lik <- adult.lik %>% dplyr::select(-mins,-age,-gender,-eth,-edu)
lca.f.adult <- as.matrix(adult.lik) ~ 1
LCAE.ad <- poLCA(lca.f.adult, data = adult.lik, nclass = 1:7)
save(blrt.ch,file="blrt.ch.RData")
save(LCAE.ad, file="LCAE.ad.RData")
blrt.ad <- poLCA.blrt(LCAE.ad)
# LCA, Adults -------------------------------------------------------------
# remove
adult.lik <- adult.lik.back
adult.lik.y <- adult.lik %>% dplyr::select(-mins,-age,-gender,-eth,-edu)
lca.f.adult <- as.matrix(adult.lik.y) ~ gender + eth + edu
# 7 classes
LCAE.ad <- poLCA(lca.f.adult, data = adult.lik, nclass = 1:7)
save(LCAE.ad, file="LCAE.ad.RData")
blrt.ch
LCAE.ad1 <- poLCA(lca.f.adult, data = adult.lik, nclass = 3:6)
LCAE.ad$output
9780/109115
LCAE.ch$LCA[[3]]
# Best Model, Youths -------------------------------------------------------
lca.best.ch <- LCAE.ch$LCA[[4]]
child.lik$class <- lca.best.ch$predclass
child.lik$post <- lca.best.ch$posterior
post.ch <- child.lik$post
# Weighted means
child.lik$mins.log <- log(child.lik$mins+1)
# probability weighted means
wmeans.child <- colSums(post.ch * child.lik$mins) / colSums(post.ch)
wmeans.log.child <- colSums(post.ch * child.lik$mins.log) / colSums(post.ch)
# weighted SD
wsd.child <- sapply(1:ncol(post.ch), function(k) {
sqrt( sum(post.ch[,k] * (child.lik$mins - wmeans.child[k])^2)
/ sum(post.ch[,k]) )
})
# weighted log sd
wsd.log.child <- sapply(1:ncol(post.ch), function(k) {
sqrt( sum(post.ch[,k] * (child.lik$mins.log - wmeans.log.child[k])^2)
/ sum(post.ch[,k]) )
})
# Put everythign together
mins.child <- data.frame(
Class = factor(1:ncol(post.ch)),
Mean = wmeans.child,
Mean.log= exp(wmeans.log.child),
SD =wsd.child,
SD.log = wsd.log.child,
SD.low = exp(wmeans.log.child - wsd.log.child) - 1,
SD.up = exp(wmeans.log.child + wsd.log.child) - 1
)
mins.child
# Best Model, Youths -------------------------------------------------------
lca.best.ch <- LCAE.ch$LCA[[3]]
child.lik$class <- lca.best.ch$predclass
child.lik$post <- lca.best.ch$posterior
post.ch <- child.lik$post
# Weighted means
child.lik$mins.log <- log(child.lik$mins+1)
# probability weighted means
wmeans.child <- colSums(post.ch * child.lik$mins) / colSums(post.ch)
wmeans.log.child <- colSums(post.ch * child.lik$mins.log) / colSums(post.ch)
# weighted SD
wsd.child <- sapply(1:ncol(post.ch), function(k) {
sqrt( sum(post.ch[,k] * (child.lik$mins - wmeans.child[k])^2)
/ sum(post.ch[,k]) )
})
# weighted log sd
wsd.log.child <- sapply(1:ncol(post.ch), function(k) {
sqrt( sum(post.ch[,k] * (child.lik$mins.log - wmeans.log.child[k])^2)
/ sum(post.ch[,k]) )
})
# Put everythign together
mins.child <- data.frame(
Class = factor(1:ncol(post.ch)),
Mean = wmeans.child,
Mean.log= exp(wmeans.log.child),
SD =wsd.child,
SD.log = wsd.log.child,
SD.low = exp(wmeans.log.child - wsd.log.child) - 1,
SD.up = exp(wmeans.log.child + wsd.log.child) - 1
)
mins.child
# check class size of candidates (need >0.5 per)
child.lik$class <- LCAE.ch$LCA[[3]]$predclass
prop.table(table(child.lik$class))
blrt.ad <- poLCA.blrt(LCAE.ad1,nreps = 10)
save(blrt.ad,file="blrt.ad.RData")
blrt.ad
blrt.ch
LCAE.ad$output
LCAE.ch$output
2868/(13000+14583)
# elbow plot
elbow.ad <- ggplot(ad.lca.output, aes(x = nclass)) +
geom_line(aes(y = BIC), color = "blue") +
geom_point(aes(y = BIC), color = "blue") +
geom_line(aes(y = AIC), color = "red") +
geom_point(aes(y = AIC), color = "red") +
labs(y = "Information Criterion", x = "Number of Classes",
title = "Elbow Plot for poLCA Model Selection",
caption = "Blue = BIC, Red = AIC") +
theme_minimal()
# Take relevant stats
ad.lca.output <- LCAE.ad$output %>% dplyr::select(nclass,llike,AIC,BIC,
Rel.Entropy,LMR,p)
ad.lca.output
# elbow plot
elbow.ad <- ggplot(ad.lca.output, aes(x = nclass)) +
geom_line(aes(y = BIC), color = "blue") +
geom_point(aes(y = BIC), color = "blue") +
geom_line(aes(y = AIC), color = "red") +
geom_point(aes(y = AIC), color = "red") +
labs(y = "Information Criterion", x = "Number of Classes",
title = "Elbow Plot for poLCA Model Selection",
caption = "Blue = BIC, Red = AIC") +
theme_minimal()
elbow.ad
# elbow.ad
poLCA.residual.pattern(LCAE.ad, nclass = 2)
poLCA.cov(LCAE.ad, nclass = 2)
# elbow.ad
poLCA.residual.pattern(LCAE.ad, nclass = 4)
poLCA.cov(LCAE.ad, nclass = 4)
# check posterior and boxplots
for(k in 3:4){
adult.lik$post <- apply(LCAE.ad$LCA[[k]]$posterior, 1, max)
adult.lik$class <- LCAE.ad$LCA[[k]]$predclass
print(
ggplot(adult.lik, aes(x = post, fill = factor(class))) +
geom_histogram(binwidth = 0.05, alpha = 0.7, position = "identity") +
labs(x = "Max Posterior Probability", y = "Count", fill = "Class",
title = paste0(k-1," Classes, adults")) +
theme_minimal()
)
print(ggplot(adult.lik, aes(x = factor(class), y = post)) +
geom_boxplot(fill = "skyblue") +
labs(x = "Class", y = "Max Posterior Probability",
title = paste0(k," Classes, adults")) +
theme_minimal()
)
}
# check class size of candidates (need >0.5 per)
adult.lik$class <- LCAE.ad$LCA[[3]]$predclass
# check class size of candidates (need >0.5 per)
adult.lik$class <- LCAE.ad$LCA[[4]]$predclass
prop.table(table(adult.lik$class))
# 4 classes is best
lca.best.ad <- LCAE.ad$LCA[[4]]
adult.lik$class <- lca.best.ad$predclass
adult.lik$post <- lca.best.ad$posterior
post.ad <- adult.lik$post
# Weighted means
adult.lik$mins.log <- log(adult.lik$mins+1)
# probability weighted means
wmeans.adult <- colSums(post.ad * adult.lik$mins) / colSums(post.ad)
wmeans.log.adult <- colSums(post.ad * adult.lik$mins.log) / colSums(post.ad)
# weighted SD
wsd.adult <- sapply(1:ncol(post.ad), function(k) {
sqrt( sum(post.ad[,k] * (adult.lik$mins - wmeans.adult[k])^2)
/ sum(post.ad[,k]) )
})
# weighted log sd
wsd.log.adult <- sapply(1:ncol(post.ad), function(k) {
sqrt( sum(post.ad[,k] * (adult.lik$mins.log - wmeans.log.adult[k])^2)
/ sum(post.ad[,k]) )
})
# Put everythign together
mins.adult <- data.frame(
Class = factor(1:ncol(post.ad)),
Mean = wmeans.adult,
Mean.log= exp(wmeans.log.adult),
SD =wsd.adult,
SD.log = wsd.log.adult,
SD.low = exp(wmeans.log.adult - wsd.log.adult) - 1,
SD.up = exp(wmeans.log.adult + wsd.log.adult) - 1
)
mins.adult
