# adeck posterior and boxplots
# for(k in 2:5){
#
#   adult.lik$post <- apply(LCAE.ad$LCA[[k]]$posterior, 1, max)
#   adult.lik$class <- LCAE.ad$LCA[[k]]$predclass
#
#   print(
#     ggplot(adult.lik, aes(x = post, fill = factor(class))) +
#       geom_histogram(binwidth = 0.05, alpha = 0.7, position = "identity") +
#       labs(x = "Max Posterior Probability", y = "Count", fill = "Class",
#            title = paste0(k+1," Classes, Adults")) +
#       theme_minimal()
#   )
#
#   print(ggplot(adult.lik, aes(x = factor(class), y = post)) +
#           geom_boxplot(fill = "skyblue") +
#           labs(x = "Class", y = "Max Posterior Probability",
#                title = paste0(k+1," Classes, Adults")) +
#           theme_minimal()
#   )
# }
# Compare class average posteriors and class prop
post5.ad <- LCAE.ad$LCA[[4]]$posterior
class5.ad <- apply(post5.ad, 1, which.max)
class.size5.ad <- prop.table(table(class5.ad))
ave.pp5.ad <- sapply(1:ncol(post5.ad), function(k) {
inds <- which(class5.ad == k)
mean(post5.ad[inds, k])
})
ave.pp5.ad
post4.ad <- LCAE.ad$LCA[[3]]$posterior
class4.ad <- apply(post4.ad, 1, which.max)
class.size4.ad <- prop.table(table(class4.ad))
ave.pp4.ad <- sapply(1:ncol(post4.ad), function(k) {
inds <- which(class4.ad == k)
mean(post4.ad[inds, k])
})
ave.pp4.ad
post3.ad <- LCAE.ad$LCA[[2]]$posterior
class3.ad <- apply(post3.ad, 1, which.max)
class.size3.ad <- prop.table(table(class3.ad))
ave.pp3.ad <- sapply(1:ncol(post3.ad), function(k) {
inds <- which(class3.ad == k)
mean(post3.ad[inds, k])
})
ave.pp3.ad
# BEST CLASS decided
# 3 classes is best
lca.best.ad <- LCAE.ad$LCA[[2]]
adult.lik$class <- lca.best.ad$predclass
adult.lik$post <- apply(lca.best.ad$posterior, 1, max)
# Calculate median minutes
n.classes <- 3
wmed.ad <- numeric(n.classes)
wq25.ad <- numeric(n.classes)
wq75.ad <- numeric(n.classes)
for (k in 1:n.classes) {
q <- wtd.quantile(adult.lik$mins,
weights = lca.best.ad$posterior[,k],
probs = c(0.25, 0.5, 0.75))
wq25.ad[k] <- q[1]
wmed.ad[k] <- q[2]
wq75.ad[k] <- q[3]
}
# Regressions
adult.lik$age <- adult.lik.back$age
adult.lik$class <- relevel(factor(adult.lik$class), ref = "1")
adult.lik$age <- relevel(factor(adult.lik$age), ref = "1")
fit.ad <- multinom(class ~ age,
data = adult.lik)
# odds ratio
or.ad <- exp(coef(fit.ad))
or.ad
sum.fit.ad <- summary(fit.ad)
se.ad <- sum.fit.ad$standard.errors
# Coefficients
coefs.ad <- coef(fit.ad)
# 95% CI for odds ratios
ci.l.ad <- exp(coefs.ad - 1.96 * se.ad)
ci.u.ad <- exp(coefs.ad + 1.96 * se.ad)
# Combine into a table
or.ci.ad <- data.frame(
CI.lower = round(ci.l.ad, 3),
CI.upper = round(ci.u.ad, 3)
)
colnames(or.ci.ad) <- c("Intercept.L", "Age2.L", "Age3.L", "Age4.L",
"Age5.L","Age6.L","Intercept.U","Age2.U", "Age3.U", "Age4.U",
"Age5.U","Age6.U")
# adeck class distribution per age
tb.byage.ad <- adult.lik %>%
count(age, class) %>%
pivot_wider(names_from = class, values_from = n, values_fill = 0)
lca_data <- child.lik[, c("abl", "enjoy")]
lca_model <- lcae.ch
set.seed(2025)
library(tidyverse)
library(ggplot2)
library(poLCA)
library(poLCAExtra)
library(scales)
library(ggthemes)
# Descriptive -------------------------------------------------------------
#
cor.ie <- cor(adult.lik.back0 %>% dplyr::select(-gender,-eth), method = "pearson")[6,1]
cor.if <- cor(adult.lik.back0 %>% dplyr::select(-gender,-eth), method = "pearson")[6,3]
cor.imp <- data.frame("Imp,Enjoy"=cor.ie, "Imp,Fit"=cor.if)
# get summary of all motives
adult.summary <- adult.var %>%
mutate(mins = DUR_HVY_CAPPED_SPORTCOUNT_A01+
DUR_MOD_CAPPED_SPORTCOUNT_A01) %>%
dplyr::select(
Enjoyment = Motiva_POP,
Social = motivex2c,
Fitness = motivex2a,
Guilt = motivc_POP,
Opportunity = READYOP1_POP,
Importance = motivb_POP,
Challenge = motivex2d,
Relaxation = motivex2b,
Minutes.Exercised = mins
) %>%
summarise(
across(everything(),
list(
Mean = ~mean(.x[.x > 0], na.rm = TRUE),
Median = ~median(.x[.x > 0], na.rm = TRUE),
SD = ~sd(.x[.x > 0], na.rm = TRUE),
PercentNA = ~mean(.x < 0, na.rm = TRUE) * 100
),
.names = "{.col}_{.fn}"
)
) %>%
pivot_longer(everything(), names_to = c("Variable", "Stat"), names_sep = "_") %>%
pivot_wider(names_from = Stat, values_from = value)
child.summary <- child.var %>%
dplyr::select(
Enjoyment = PL_Enjoy_bc_ans,
Social = MO_Fun_c,
Fitness = MO_Fit_c,
Opportunity = MO_Opp_c,
Guilt = MO_Guilt_c,
Importance = PL_GdMe_bc_ans,
Challenge = Try_bc,
Relaxation = MO_Relax_c
) %>%
summarise(
across(everything(),
list(
Mean = ~mean(.x[.x > 0 & .x <= 4], na.rm = TRUE),
Median = ~median(.x[.x > 0 & .x <= 4], na.rm = TRUE),
SD = ~sd(.x[.x > 0 & .x <= 4], na.rm = TRUE),
PercentNA = ~mean(.x < 0 | .x > 4, na.rm = TRUE) * 100
),
.names = "{.col}_{.fn}"
)
) %>%
pivot_longer(everything(), names_to = c("Variable", "Stat"), names_sep = "_") %>%
pivot_wider(names_from = Stat, values_from = value)
c.mins <- child.var %>%
summarise(Variable = "Minutes.Exercised",
Mean = mean(mins_modplus_outschool_Week_ALL[mins_modplus_outschool_Week_ALL > 0 ], na.rm = TRUE),
Median = median(mins_modplus_outschool_Week_ALL[mins_modplus_outschool_Week_ALL > 0], na.rm = TRUE),
SD = sd(mins_modplus_outschool_Week_ALL[mins_modplus_outschool_Week_ALL > 0], na.rm = TRUE),
PercentNA = mean(mins_modplus_outschool_Week_ALL < 0, na.rm = TRUE) * 100)
child.summary <- rbind(child.summary, c.mins)
# get demographic overview (gender, edu, eth, mins)
# adult
#
# # Disability
# gg.ad.dsbl <- ggplot(adult.var, aes(x = as.factor(Disab2_POP))) +
#   geom_bar() +
#   labs(x = "Disability") +
#   theme_clean()
# Gender
adult.lik$gender <- factor(adult.lik$gender, levels = c(1, 2),
labels = c("Male", "Female"))
gg.ad.gend <- ggplot(adult.lik, aes(x = as.factor(gender))) +
geom_bar() +
labs(x = "Gender") +
theme_clean()
# Age
adult.lik$age <- factor(adult.lik$age, levels = c(1,2,3,4,5,6),
labels = c("16-34", "35-44", "45-54",
"55-64", "65-74", "75+"))
gg.ad.age <-ggplot(adult.lik, aes(x = as.factor(age))) +
geom_bar() +
labs(x = "Age Group") +
theme_clean()
# Ethnicity
adult.lik$eth <- factor(adult.lik$eth, levels = c(1, 2),
labels = c("White British", "Other"))
gg.ad.eth <- ggplot(adult.lik, aes(x = as.factor(eth))) +
geom_bar() +
labs(x = "Ethnicity") +
theme_clean()
# Education
# gg.ad.edu <- ggplot(adult.lik, aes(x = as.factor(edu))) +
#   geom_bar() +
#   labs(x = "Education") +
#   theme_clean()
# YOuths
#
# Disability
# gg.ch.dsbl <- ggplot(child.var, aes(x = as.factor(Disab_All_POP))) +
#   geom_bar() +
#   labs(x = "Disability") +
#   theme_clean()
# Gender
child.lik$gender <- factor(child.lik$gender, levels = c(1, 2),
labels = c("Male", "Female"))
gg.ch.gend <- ggplot(child.lik, aes(x = as.factor(gender))) +
geom_bar() +
labs(x = "Gender") +
theme_clean()
# Age
child.lik$age <- factor(child.lik$age, levels = c(1,2,3,4,5,6),
labels = c(11,12,13,14,15,16))
gg.ch.age <- ggplot(child.lik, aes(x = as.factor(age))) +
geom_bar() +
labs(x = "Age") +
theme_clean()
# Ethnicity
child.lik$eth <- factor(child.lik$eth, levels = c(1, 2),
labels = c("White British", "Other"))
gg.ch.eth <- ggplot(child.lik, aes(x = as.factor(eth))) +
geom_bar() +
labs(x = "Ethnicity") +
theme_clean()
# SEM ---------------------------------------------------------------------
# # slope_youth - slope_adult, pooled sd
# cohen <- rbind(cohen.enj, cohen.soc, cohen.fit,cohen.glt,cohen.opp)
# rownames(cohen) <- c("Enjoy", "Social", "Fit","Guilt","Opp")
# colnames(cohen) <- c("Std Eff", "Min")
# cohen
# LCA Youths---------------------------------------------------------------
# elbow plot
gg.elbow.ch <- ggplot(ch.lca.output, aes(x = nclass)) +
geom_line(aes(y = BIC), color = "blue") +
geom_point(aes(y = BIC), color = "blue") +
geom_line(aes(y = AIC), color = "red") +
geom_point(aes(y = AIC), color = "red") +
labs(y = "Information Criterion", x = "Number of Classes",
title = "Elbow Plot, Youths",
caption = "Blue = BIC, Red = AIC") +
theme_clean()
gg.elbow.ch
gg.llik.ch <- ggplot(ch.lca.output, aes(x = nclass)) +
geom_line(aes(y = llike), color = "blue") +
geom_point(aes(y = llike), color = "blue") +
labs(y = "Log-Likelihood", x = "Number of Classes",
title = "Log-Likelihood, Youths") +
theme_clean()
gg.llik.ch
#
# # Max posterior
# gg.post.his.ch <- ggplot(child.lik, aes(x = post, fill = factor(class))) +
#   geom_histogram(binwidth = 0.05, alpha = 0.7, position = "identity") +
#   labs(x = "Max Posterior Probability", y = "Count", fill = "Class",
#        title = paste0(k," Classes, Youths")) +
#   theme_clean()
# gg.post.his.ch
#
# # Boxplot
# gg.post.box.ch <- ggplot(child.lik, aes(x = factor(class), y = post)) +
#   geom_boxplot(fill = "skyblue") +
#   labs(x = "Class", y = "Max Posterior Probability",
#        title = paste0(k," Classes, Youths")) +
#   theme_clean()
# class,size/proportion, average pp,entropy
tb.class3.ch <- data.frame(
Class = 1:ncol(post3.ch),
Proportion = as.numeric(class.size3.ch),
Avg_Posterior = round(ave.pp3.ch, 3)
)
tb.class3.ch
tb.class4.ch <- data.frame(
Class = 1:ncol(post4.ch),
Proportion = as.numeric(class.size4.ch),
Avg_Posterior = round(ave.pp4.ch, 3)
)
# Weighted minutes, youths
mins.child <- data.frame(
Class = 1:n.classes,
Weighted.Median = wmed.ch,
Weighted.Q25 = wq25.ch,
Weighted.Q75 = wq75.ch
)
mins.child
gg.mins.ch <- ggplot(mins.child, aes(x = factor(Class), y = Weighted.Median)) +
geom_point(size = 3, color = "blue") +                 # median as a point
geom_errorbar(aes(ymin = Weighted.Q25, ymax = Weighted.Q75),
width = 0.2, color = "darkblue") +      # IQR as error bars
labs(x = "Class", y = "Minutes (Weighted Median ± IQR)",
title = "Weighted Median and IQR per Class") +
theme_clean()
gg.mins.ch
gg.med.ch <- ggplot(mins.child, aes(x = Class, y = Weighted.Median)) +
geom_col() +
labs(x = "Latent Class", y = "Probability-Weighted Median Minutes")
gg.med.ch
# Predictor plot
plot(LCAE.ch, nclass = 2)
# Bootstrap Vuong-Lo-Mendell-Rubin Likelihood Ratio Test
or.ch
# Appendix
or.ci.ch
# Include actual coeffs in appendix
lca.best.ch$probs
tb.byage.ch
gg.byage.ch <- child.lik %>%
dplyr::count(age, class) %>%
group_by(age) %>%
mutate(prop = n / sum(n)) %>%
ggplot(aes(x = factor(age), y = prop, fill = factor(class))) +
geom_col() +
labs(x = "Age group", y = "Proportion", fill = "Class") +
scale_y_continuous(labels = scales::percent_format()) +
theme_clean()
gg.byage.ch
vars.ch <- setdiff(names(child.lik), c("age","mins","post","class",
"gender","eth","edu"))
child.lik_long <- child.lik %>%
pivot_longer(cols = all_of(vars.ch), names_to = "variable", values_to = "score") %>%
count(age, variable, score) %>%
group_by(age, variable) %>%
mutate(prop = n / sum(n))
gg.vars.ch <- ggplot(child.lik_long, aes(x = factor(age), y = prop, fill = factor(score))) +
geom_col() +
facet_wrap(~variable, nrow = 3, ncol = 3) +
labs(x = "Age group", y = "Proportion", fill = "Score") +
scale_y_continuous(labels = percent_format()) +
theme_clean() +
theme(legend.position = "bottom", axis.text.y = element_text(size = 6))
# LCA Adults --------------------------------------------------------------
# elbow plot
gg.elbow.ad <- ggplot(ad.lca.output, aes(x = nclass)) +
geom_line(aes(y = BIC), color = "blue") +
geom_point(aes(y = BIC), color = "blue") +
geom_line(aes(y = AIC), color = "red") +
geom_point(aes(y = AIC), color = "red") +
labs(y = "Information Criterion", x = "Number of Classes",
title = "Elbow Plot, Adults",
caption = "Blue = BIC, Red = AIC") +
theme_clean()
gg.elbow.ad
gg.llik.ad <- ggplot(ad.lca.output, aes(x = nclass)) +
geom_line(aes(y = llike), color = "blue") +
geom_point(aes(y = llike), color = "blue") +
labs(y = "Log-Likelihood", x = "Number of Classes",
title = "Log-Likelihood, Adults") +
theme_clean()
gg.llik.ad
# # Max posterior
# gg.post.his.ad <- ggplot(adult.lik, aes(x = post, fill = factor(class))) +
#   geom_histogram(binwidth = 0.05, alpha = 0.7, position = "identity") +
#   labs(x = "Max Posterior Probability", y = "Count", fill = "Class",
#        title = paste0(k," Classes, Adults")) +
#   theme_clean()
# gg.post.his.ad
#
# # Boxplot
# gg.post.box.ad <- ggplot(adult.lik, aes(x = factor(class), y = post)) +
#   geom_boxplot(fill = "skyblue") +
#   labs(x = "Class", y = "Max Posterior Probability",
#        title = paste0(k," Classes, Adults")) +
#   theme_clean()
# class,size/proportion, average pp,entropy
tb.class3.ad <- data.frame(
Class = 1:ncol(post3.ad),
Proportion = as.numeric(class.size3.ad),
Avg_Posterior = round(ave.pp3.ad, 3)
)
tb.class3.ad
mins.adult <- data.frame(
Class = 1:n.classes,
Weighted.Median = wmed.ad,
Weighted.Q25 = wq25.ad,
Weighted.Q75 = wq75.ad
)
mins.adult
gg.mins.ad <- ggplot(mins.adult, aes(x = factor(Class), y = Weighted.Median)) +
geom_point(size = 3, color = "blue") +                 # median as a point
geom_errorbar(aes(ymin = Weighted.Q25, ymax = Weighted.Q75),
width = 0.2, color = "darkblue") +      # IQR as error bars
labs(x = "Class", y = "Minutes (Weighted Median ± IQR)",
title = "Weighted Median and IQR per Class") +
theme_clean()
gg.mins.ad
#
# # Weighted minutes, youths
# gg.med.ad <- ggplot(mins.adult, aes(x = Class, y = Weighted.Median)) +
#   geom_col() +
#   labs(x = "Latent Class", y = "Probability-Weighted Median Minutes")
# Predictor plot
plot(LCAE.ad, nclass = 2)
# plot(LCAE.ad, nclass = 3)
# Bootstrap Vuong-Lo-Mendell-Rubin Likelihood Ratio Test
# 100 reps
# blrt.ad
or.ad
or.ci.ad
# Include actual coeffs in appendix
lca.best.ad$probs
tb.byage.ad
gg.byage.ad <- adult.lik %>%
dplyr::count(age, class) %>%
group_by(age) %>%
mutate(prop = n / sum(n)) %>%
ggplot(aes(x = factor(age), y = prop, fill = factor(class))) +
geom_col() +
labs(x = "Age group", y = "Proportion", fill = "Class") +
scale_y_continuous(labels = scales::percent_format()) +
theme_clean()
gg.byage.ad
vars.ad <- setdiff(names(adult.lik), c("age","mins","post","class",
"gender","eth","edu"))
adult.lik_long <- adult.lik %>%
pivot_longer(cols = all_of(vars.ad), names_to = "variable", values_to = "score") %>%
count(age, variable, score) %>%
group_by(age, variable) %>%
mutate(prop = n / sum(n))
gg.vars.ad <- ggplot(adult.lik_long, aes(x = factor(age), y = prop, fill = factor(score))) +
geom_col() +
facet_wrap(~variable, nrow = 3, ncol = 3) +
labs(x = "Age group", y = "Proportion", fill = "Score") +
scale_y_continuous(labels = percent_format()) +
theme_clean() +
theme(legend.position = "bottom", axis.text.y = element_text(size = 6))
gg.vars.ad
wmed.ad
tb.class3.ad
gg.mins.ch
gg.elbow.ad
gg.llik.ad
tb.class4.ad
tb.class4.ad <- data.frame(
Class = 1:ncol(post4.ad),
Proportion = as.numeric(class.size4.ad),
Avg_Posterior = round(ave.pp4.ad, 4)
)
tb.class4.ad
tb.class5.ad <- data.frame(
Class = 1:ncol(post5.ad),
Proportion = as.numeric(class.size5.ad),
Avg_Posterior = round(ave.pp5.ad, 5)
)
tb.class5.ad
tb.class6.ad <- data.frame(
Class = 1:ncol(post6.ad),
Proportion = as.numeric(class.size6.ad),
Avg_Posterior = round(ave.pp6.ad, 6)
)
tb.class6.ad
post6.ad <- LCAE.ad$LCA[[5]]$posterior
class6.ad <- apply(post6.ad, 1, which.max)
class.size6.ad <- prop.table(table(class6.ad))
ave.pp6.ad <- sapply(1:ncol(post6.ad), function(k) {
inds <- which(class6.ad == k)
mean(post6.ad[inds, k])
})
ave.pp6.ad
tb.class6.ad <- data.frame(
Class = 1:ncol(post6.ad),
Proportion = as.numeric(class.size6.ad),
Avg_Posterior = round(ave.pp6.ad, 6)
)
tb.class6.ad
LCAE.ad
LCAE.ad$output
ad.lca.output
plot(LCAE.ad, nclass = 2)
plot(LCAE.ad, nclass = 3)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 2)
plot(LCAE.ad, nclass = 4)
plot(LCAE.ad, nclass = 3)
plot(LCAE.ad, nclass = 2)
gg.byage.ad
summary(LCAE.ad, nclass = 2)
LCAE.ad$LCA
LCAE.ad$LCA[[2]]
gg.mins.ad
tb.mins.ad
mins.adult
plot(LCAE.ch, nclass=2)
plot(LCAE.ch, nclass=3)
LCAE.ch$LCA[[2]]
plot(LCAE.ad, nclass=2)
plot(LCAE.ad, nclass=3)
LCAE.ad$LCA[[3]]
gg.byage.ad
tb.byage.ad
gg.mins.ad
mins.ad
mins.adult
plot(LCAE.ad, nclass=2)
gg.byage.ad
gg.byage.ch
gg.byage.ch
gg.mins.ch
gg.mins.ch
gg.mins.ad
mins.adult
mins.child
gg.vars.ad
or.ci.ad
or.ad
or.ch
or.ci.ch
rmdwc::rmdcount('Paper.rmd')
